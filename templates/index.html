{% extends "base.html" %}

{% block content %}
<div class="voting-container text-center">
    <h1 class="mb-4">SLGS OBU General Election</h1>
    <p class="lead mb-4">Welcome to the Sierra Leone Grammar School Old Boys Union General Election</p>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="alert alert-info">
                <h5>How to Vote:</h5>
                <ol class="text-start">
                    <li>Receive your unique Voter ID (same as your Member ID) from the election committee</li>
                    <li>Go to the voting page and enter your Voter ID and Voting Token</li>
                    <li>Vote for candidates in all 12 positions</li>
                    <li>Submit your votes - you can only vote once per election!</li>
                </ol>
            </div>

            <div class="alert alert-warning">
                <strong>Important:</strong> Your Voter ID (Member ID) and Voting Token are unique and can only be used once. Keep them secure and use them to cast your votes.
            </div>

            <div class="mt-4 text-center">
                <div id="votingStatusWrapper" class="mb-3">
                    <span id="votingStatusBadge" class="badge bg-secondary">Checking...</span>
                    <small id="votingUntilText" class="ms-2 text-muted"></small>
                </div>

                <a href="/vote" id="startVotingBtn" class="btn btn-success btn-lg">Start Voting</a>
                <p class="mb-3 mt-3">Questions? Contact the election committee for assistance.</p>
            </div>
        </div>
    </div>
</div>
<script>
// Update voting button and badge based on /admin/voting-status
async function updateVotingStatus() {
    try {
        const res = await fetch('/admin/voting-status');
        if (!res.ok) return;
        const data = await res.json();
        const badge = document.getElementById('votingStatusBadge');
        const untilText = document.getElementById('votingUntilText');
        const startBtn = document.getElementById('startVotingBtn');
        if (data.voting_open) {
            badge.textContent = 'Voting OPEN';
            badge.className = 'badge bg-success';
            startBtn.classList.remove('disabled');
            startBtn.href = '/vote';
        } else {
            badge.textContent = 'Voting CLOSED';
            badge.className = 'badge bg-danger';
            // disable the link when closed
            startBtn.classList.add('disabled');
            startBtn.removeAttribute('href');
        }
        if (data.voting_until) {
            untilText.textContent = 'Until: ' + new Date(data.voting_until).toLocaleString();
        } else {
            untilText.textContent = '';
        }
    } catch (e) {
        // ignore
    }
}

document.addEventListener('DOMContentLoaded', function() {
    updateVotingStatus();
    setInterval(updateVotingStatus, 60 * 1000);
});
</script>
{% endblock %}